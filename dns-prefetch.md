# [优化] - DNS预读取

今天在学习公司内部代码规范中看到这样一行代码：

```html
<!-- S DNS预解析 -->
<link rel="dns-prefetch" href="">
<!-- E DNS预解析 --> 
```

不明所以，便查了一下 [MDN](https://developer.mozilla.org/zh-CN/docs/Controlling_DNS_prefetching)，主要是针对于页面中资源请求前，资源的域名DNS预解析使用的，更具体的解释我们往下看。

### 面试题：浏览器输入URL后发生了什么？

很多小伙伴应该在刷面试题时应该都有遇到过这样一道：『[浏览器输入 URL 后发生了什么？](https://zhuanlan.zhihu.com/p/43369093)』，忘记答案的自行复习，这样的面试题的回答，一般都是从键盘输入网址回车后，到页面完全展示到浏览器为止，整个过程中的每一个细节的解释。而这个面试题和我今天要记录的知识点有什么关系呢，正是与该面试题中的一环有点关系。

### DNS解析

如果我们想打开百度，在浏览器中输入 `www.baidu.com` 即可，这是域名，浏览器如果想找到百度的服务器，请求并返回内容，是无法直接通过域名来操作的，浏览器可识别的是 **ip** 地址，**DNS解析** 即是通过域名得到ip地址的过程。那这件事由谁来做呢，首先浏览器向本地的DNS服务器发起请求，由本地DNS服务器处理，如果本地的DNS服务器没有对应的域名缓存，则需要采用递归或迭代查询的方式依次向根域名服务器、顶级域名服务器、权威域名服务器发起查询请求，直到找到一个或一组IP地址，返回给浏览器。一般本地的DNS地址由ISP（Internet Service Provider，互联网服务提供商）通过DHCP协议动态分配。[更多](https://zh.wikipedia.org/wiki/%E5%9F%9F%E5%90%8D%E7%B3%BB%E7%BB%9F#%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90)

### 什么是DNS预读取

DNS预读取是一项使浏览器器主动去执行域名解析的功能，其范围包括文档的所有链接，无论是图片，CSS，JavaScript等其它用户能够点击的URL。

因为预读取会在后台执行，所以DNS很可能在链接对应的东西出现之前就已经解析完毕。这能够减少用户点击链接时的延迟。

DNS请求需要的带宽非常小，但是延迟却有点高，手机网络尤为明显。DNS预读取能让延迟明显减少，在某些情况下甚至可以达到一秒钟。这样可以及大的加速（尤其是移动网络环境下）页面的加载。在发起图片加载请求之前预先把域名解析好将至少5%的图片加载速度提升。

### 开启方法

开启DNS预解析的方法有两种，一种是通过HTTP请求头中的 `X-DNS-Prefetch-Control` 头控制，另一种是文档中的 `meta` 标签控制。

#### http请求头配置

语法：

```http
X-DNS-Prefetch-Control: on
X-DNS-Prefetch-Control: off
```


* **on**：启用DNS预解析。在浏览器支持DNS预解析的特性时即使不使用该标签浏览器依然会进行预解析。
* **off**：关闭DNS预解析。这个属性在页面上的链接并不是由你控制的或是你根本不想向这些域名引导数据时非常有用。

#### meta标签配置

```html
<meta http-equiv="x-dns-prefetch-control" content="off">
```

语法与使用方式同上。

#### 强制查询特定主机名

通过使用 `ref` 属性值为 [link type](https://developer.mozilla.org/en-US/docs/Web/HTML/Link_types) 中的 `dns-prefetch` 的 `<link>` 标签来对特定域名进行预读取：

```html
<link ref="dns-prefetch" href="https://google.com">
```

强制对域名进行预解析在一些情况下很有用，比如，在网站的主页上，强制在整个网站上频繁引用的域名的预解析，即使它们不在主页本身上使用。即使主页的性能可能不受影响，这将提高整体站点性能。